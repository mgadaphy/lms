<!DOCTYPE html>
<html>
<head>
    <title>Profile Completion Debug</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-info { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        select, input { width: 100%; padding: 8px; margin-bottom: 10px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Profile Completion Debug Test</h1>
    
    <div class="debug-info">
        <h3>Debug Information</h3>
        <div id="debug-output"></div>
    </div>
    
    <div class="form-group">
        <label for="country">Country:</label>
        <select id="country" name="country">
            <option value="">Select Country</option>
            <option value="1">Afghanistan</option>
            <option value="2">Aland Islands</option>
            <option value="3">Albania</option>
            <option value="4">Algeria</option>
            <option value="5">American Samoa</option>
            <option value="38">Cameroon</option>
            <option value="39">Canada</option>
            <option value="40">Cape Verde</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="state">State/Province:</label>
        <select id="state" name="state" class="stateList">
            <option value="">Select State</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="city">City:</label>
        <select id="city" name="city" class="cityList">
            <option value="">Select City</option>
        </select>
    </div>
    
    <script>
        $(document).ready(function() {
            // Debug function
            function log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
                $('#debug-output').append(`<div style="color: ${color}">[${timestamp}] ${message}</div>`);
                $('#debug-output').scrollTop($('#debug-output')[0].scrollHeight);
            }
            
            log('Page loaded successfully');
            
            // Initialize Select2 for state
            $('.stateList').select2({
                ajax: {
                    url: '/ajax_states.php',
                    type: "GET",
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        var query = {
                            search: params.term,
                            page: params.page || 1,
                            id: $('#country').find(':selected').val(),
                        }
                        log(`State AJAX request: ${JSON.stringify(query)}`);
                        return query;
                    },
                    success: function(data) {
                        log(`State AJAX success: ${JSON.stringify(data)}`, 'success');
                    },
                    error: function(xhr, status, error) {
                        log(`State AJAX error: ${status} - ${error}`, 'error');
                        log(`Response: ${xhr.responseText}`, 'error');
                    },
                    cache: false
                }
            });
            
            // Initialize Select2 for city
            $('.cityList').select2({
                ajax: {
                    url: '/ajax_cities.php',
                    type: "GET",
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            search: params.term,
                            page: params.page || 1,
                            id: $('#state').find(':selected').val(),
                        }
                    },
                    cache: false
                }
            });
            
            // Country change event
            $('#country').on('change', function() {
                const countryId = $(this).val();
                const countryName = $(this).find(':selected').text();
                
                log(`Country changed to: ID=${countryId}, Name="${countryName}"`);
                
                // Clear state and city
                $('.stateList').val(null).trigger('change');
                $('.cityList').val(null).trigger('change');
                
                if (countryId) {
                    log(`Country selected - should trigger state loading for country ID: ${countryId}`);
                } else {
                    log('No country selected');
                }
            });
            
            // State change event
            $('#state').on('change', function() {
                const stateId = $(this).val();
                const stateName = $(this).find(':selected').text();
                
                log(`State changed to: ID=${stateId}, Name="${stateName}"`);
                
                // Clear city
                $('.cityList').val(null).trigger('change');
                
                if (stateId) {
                    log(`State selected - should trigger city loading for state ID: ${stateId}`);
                } else {
                    log('No state selected');
                }
            });
            
            // Test button
            $('<button>').text('Test Cameroon Selection').click(function() {
                log('=== MANUAL TEST: Selecting Cameroon ===');
                $('#country').val('38').trigger('change');
            }).appendTo('body');
            
            // Test AJAX directly
            $('<button>').text('Test AJAX Directly').click(function() {
                log('=== MANUAL TEST: Direct AJAX Call ===');
                $.ajax({
                    url: '/ajax_states.php',
                    method: 'GET',
                    data: { id: 38, search: '' },
                    success: function(data) {
                        log(`Direct AJAX success: ${JSON.stringify(data)}`, 'success');
                    },
                    error: function(xhr, status, error) {
                        log(`Direct AJAX error: ${status} - ${error}`, 'error');
                        log(`Response: ${xhr.responseText}`, 'error');
                    }
                });
            }).appendTo('body');
        });
    </script>
</body>
</html> 